var poem=new Array;var live=new Array;var w_height=0;var w_width=0;var TogetherJSConfig_autoStart=true;var TogetherJSConfig_suppressJoinConfirmation=true;var TogetherJSConfig_disableWebRTC=true;var TogetherJSConfig_suppressInvite=true;var TogetherJSConfig_findRoom="strange_loops";var TogetherJSConfig_dontShowClicks=true;var TogetherJSConfig_toolName="Strange Loops";var TogetherJSConfig_siteName="Strange Loops";var TogetherJSConfig_inviteFromRoom="strange_loops";var TogetherJSConfig_cloneClicks=true;var TogetherJSConfig_youtube=false;var TogetherJSConfig_hub_on={"togetherjs.chat":function(msg){console.log(msg.text)},"togetherjs.form-focus":function(msg){res=regexp_clonedclk(msg.element);orders=poem[res[1]][1].split(",");pos=orders[res[2]-1];switch_word(res[1],pos-1,res[2]-1)}};TogetherJSConfig_on={ready:function(){$("#togetherjs-dock").hide();$("#togetherjs-menu").hide()}};$(document).ready(function(){$.ajax({type:"GET",url:"poem.xml",dataType:"xml",success:function(xml){var $parsed=$(xml);var $texto=$parsed.find("texto");$texto.each(function(){var $entry=$(this);var verso=$entry.attr("verso");var ordem=$entry.attr("ordem");var taxon=$entry.attr("taxon");poem.push(new Array(verso,ordem,taxon));live.push(verso)});var $cats=$parsed.find("categorias");$cats.contents().each(function(i,el){if(el.nodeType==1){$element=$parsed.find(el.nodeName);window[el.nodeName]=new Array;$element.contents().each(function(){var $elem=$(this);elem=$.trim($elem.text());if(elem.length>0)window[el.nodeName].push(elem)})}});var $audio=$parsed.find("audio");$audio.contents().each(function(i,el){if(el.nodeType==1){$element=$parsed.find(el.nodeName);window[el.nodeName]=new Array;$element.contents().each(function(){var $elem=$(this);elem=$.trim($elem.text());if(elem.length>0)window[el.nodeName].push(elem)})}});resize_window();$(window).bind("resize",resize_window);for(var i=0;i<poem.length;i++){words=poem[i][0].split(" ");orders=poem[i][1].split(",");taxons=poem[i][2].split(",");var line="";for(var j=0;j<words.length;j++){pos=orders.indexOf(String(j+1));if(pos!=-1)line+=' <a id="palavra'+j+'" href="#" onclick="switch_word('+i+","+j+","+pos+');">'+words[j]+"</a>";else line+=" "+words[j]}$("#container").append('<p class="versos" id="linha'+i+'">'+line+"</p>");line=""}}})});function regexp_clonedclk(element){var rx=/linha(\d):nth-child\((\d)\)/;var arr=rx.exec(element);return arr}function switch_word(row,col,edit_pos){var words=poem[row][0].split(" ");var orders=poem[row][1].split(",");var taxons=poem[row][2].split(",");var line="";for(var j=0;j<words.length;j++){var pos=orders.indexOf(String(j+1));if(pos!=-1){if(j==col){var taxons_list=window[taxons[edit_pos]];words[j]=taxons_list[Math.floor(Math.random()*taxons_list.length)]}line+=' <a id="palavra'+j+'" href="#" onclick="switch_word('+row+","+j+","+pos+');">'+words[j]+"</a>"}else line+=" "+words[j]}$("#linha"+row).html(line)}function resize_window(e){w_height=$(window).height();w_width=$(window).width();$("#container").height(w_height)+"px";$("#container").width(w_width)+"px";$("#help").height(90)+"px";$("#help").width(w_width)+"px";$("#help").css("top",w_height-100)}function linkify(inputText){var replacedText,replacePattern1,replacePattern2,replacePattern3;replacePattern1=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;replacedText=inputText.replace(replacePattern1,'<a href="$1" target="_blank">$1</a>');replacePattern2=/(^|[^\/])(www\.[\S]+(\b|$))/gim;replacedText=replacedText.replace(replacePattern2,'$1<a href="http://$2" target="_blank">$2</a>');replacePattern3=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;replacedText=replacedText.replace(replacePattern3,'<a href="mailto:$1">$1</a>');return replacedText}